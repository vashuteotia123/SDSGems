<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
</head>
<body><h1><center>
    Diamonds
</center></h1>
<br>
<br>
    <div class="container">
        <table border="1">
            <thead>
                <th>Stock ID</th>
                <th>Location</th>
                <th>certificate</th>
                <th>Add to Cart</th>
                <th>check</th>
            </thead>
            <tbody>
                {% csrf_token %}
                {% for p in products_d %}
                {% if p.appvreturnstatus_d is False %}
                <tr id="{{p.id}}">
                    <td>{{p.stockid}}</td>
                    <td>{{p.location}}</td>
                    <td>{{p.certificate_no_d}}</td>
                    
                    {% if p.cartstatus is False %}
                    <td><a class="btn btn-primary" href="{% url 'addtocart_d' id=p.id %}">ADD TO CART</a></td>
                    {% endif %}
                    {% if p.cartstatus is True %}
                    <td><a class="btn btn-primary">Go To CART</a></td>
                    {% endif %}
                    {% if p.appvreturnstatus_d is False and p.purchaseapv_d is False %}
                    <td><input type="checkbox" name="d_id[]" value="{{p.id}}" class="save-cb-state"
                            id="delete_d"></td>
                    {% endif %}
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
            </table>
            </div>
            <div>
                <button type="submit" id="delete_btn">Add to return table</button>
            </div>
            <div>
                <a class="btn btn-primary" href="{% url 'retobj_d' %}">View returned objects</a>
                <a class="btn btn-primary" href="{% url 'displaycart2_d' %}">View Cart</a>
            </div>
            <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
        
            <script>
                if (!$) {
                    $ = django.jQuery;
                }
                $(document).ready(function () {
                    $('#delete_btn').click(function () {
                        if (confirm("You want to delete this")) {
                            var id = [];
                            var csrf = $('input[name=csrfmiddlewaretoken').val()
                            $(':checkbox:checked').each(function (i) {
        
                                id[i] = $(this).val()
                                console.log("ajax called")
                                console.log(id[0])
                            })
                            if (id.length == 0) {
                                alert("No items Selected Please Select Again");
        
                            }
                            else {
                                $.ajax({
                                    url: '.',
                                    method: "POST",
                                    data: {
                                        id,
                                        csrfmiddlewaretoken: csrf,
                                    },
        
                                    success: function (response) {
                                        window.location.reload();
                                        for (var i = 0; i < id.length; i++) {
        
                                            $('tr#' + id[i] + '').css('background-color', '#ccc');
                                            $('tr#' + id[i] + '').fadeOut('slow');
        
                                        }
        
                                    }
        
                                });
                            }
        
        
                        }
        
        
        
        
                    });
        
                });
            </script>
        </body>
        
        </html>
    
    