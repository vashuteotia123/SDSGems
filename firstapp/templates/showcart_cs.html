{% extends 'common_table.html' %}
{% block table %}
{% if messages%}
    {% for message in messages%}
    {{message}}
    {%endfor%}
    {%endif%}
  <table class="table table-responsive">
        <tr class="bg-primary bg-opacity-50" id="table-heading">
            <th class="bg-primary">STOCK ID</th>
            <th class="bg-primary" >LOCATION</th>
            <th class="bg-primary" style="text-align:center;">SHAPE</th>
            <th class="bg-primary" style="text-align:center;">GEM TYPE</th>
            <th class="bg-primary">ORIGIN</th>
            <th class="bg-primary" style="text-align:center;">TREATMENT</th>
            <th class="bg-primary">CLARITY</th>
            <th class="bg-primary">CERTIFICATE NUMBER</th>
            <th class="bg-primary">COLOURS</th>
            <th class="bg-primary">MEASUREMENTS</th>
            <th class="bg-primary">LAB</th>
            <th class="bg-primary">PIECES</th>
            <th class="bg-primary">WEIGHT</th>
            <th class="bg-primary">PRICE</th>
            <th class="bg-primary">UNITS</th>
            <th class="bg-primary">AMOUNT</th>
            <th class="bg-primary">DISCOUNT</th>
            <th class="bg-primary">DISCOUNTED AMOUNT</th>
            <th class="bg-primary">TOTAL VALUE</th>
            <th class="bg-primary">CURRENCY</th>
            <th class="bg-primary">TAG PRICE</th>
            <th class="bg-primary">RATE</th>
            <th class="bg-primary">SOLD ITEM</th>
        </tr>
  <form method="post" action="">
          {%csrf_token%} {{totalitems_cs.management_form }}
        {% for obj in totalitems_cs %}
        <tr>
            <td style="text-align:center;">{{obj.stockid}}</td>
            <td>{{obj.location}}</td>
            <td>{{obj.shape}}</td>
            <td>{{obj.gem_type}}</td>
            <td>{{obj.origin}}</td>
            <td>{{obj.treatment}}</td>
            <td>{{obj.Clarity}}</td>
            <td>{{obj.certificate_no}}</th>
            <td>{{obj.color}}</td>
            <td>{{obj.measurements}}</td>
            <td>{{obj.lab}}</td>
            <td>{{obj.PCS}}</td>
            <td>{{obj.Weight_cs}}</td>
            <td>{{obj.price}}</td>
            <td>{{obj.units_cs}}</td>
            <td>{{obj.amount_cs}}</td>
            <td>{{obj.DIS_cs}}</td>
            <td>{{obj.DIS_amount_cs}}</td>
            <td>{{obj.total_value_cs}}</td>
            <td>{{obj.currency_cs}}</td>
            <td>{{obj.tag_price_cs}}</td>
            <td>{{obj.rate_cs}}</td>
            <td>{{obj.sold_items}}</td>
        </tr>
        {% endfor %}
    </table>
    {% if is_valid%}
    {%endif%}
    <div id="sell_cart">
    <span id="total_header">Total Value of all items: </span><span id="total_amount_cum">0</span>
    </div> 
    <div id="allign_btn">
      <button class="btn btn-3 btn-success" type="submit" onclick=''>Submit</button>
      <a class="btn btn-3 btn-warning" style="margin-right: 80px;" href="{% url 'sell_cs' %}">Sell</a>
    </div>

    </form>
{% endblock  %}
    
  {% block script %}
  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <script>

    var s = " ";
    var formCnt = "{{itemcount}}";
    var k = "$('#id_form-0-company_name').on('change keyup blur',function(){var a = document.getElementById('id_form-0-company_name').value;document.getElementById('id_form-0-company_name').value = a;"
    var k1 = ";});";

    var discount_str = " ";
    var total_amount = "$(document).on('keyup', function(){ var total_amount_value = 0";
    var total_amount1 = ";if(!isNaN(total_amount_value)) document.getElementById('total_amount_cum').innerHTML = total_amount_value.toFixed(2);});";
    
    // $('#id_form-0-price').on("change keyup blur",function(){document.getElementById('id_form-0-amount_cs').value = 8349983});
    for( var i = 0; i < formCnt; i++){
      s+="$('#id_form-"+ i + "-price').on('change keyup blur', function(){var price = document.getElementById('id_form-"+i+"-price').value; var weight = document.getElementById('id_form-"+i+"-Weight_cs').value; document.getElementById('id_form-"+i+"-amount_cs').value = (weight * price).toFixed(2);  });   ";
      k+="document.getElementById('id_form-"+i+"-company_name').value = a; ";
      discount_str+="$('#id_form-"+ i + "-DIS_cs').on('change keyup blur', function(){var discount = document.getElementById('id_form-"+i+"-DIS_cs').value; var amount = document.getElementById('id_form-"+i+"-amount_cs').value; document.getElementById('id_form-"+i+"-DIS_amount_cs').value = ((amount * discount)/100).toFixed(2); document.getElementById('id_form-"+i+"-total_value_cs').value = (amount - ((amount * discount)/100)).toFixed(2);  });   ";
      total_amount+="+parseFloat(document.getElementById('id_form-"+ i +"-total_value_cs').value)" 
      eval(s);
      eval(k+k1);
      eval(discount_str);
      eval(total_amount+total_amount1);
    }
    eval(s);
    eval(k+k1);
    eval(discount_str);
    eval(total_amount+total_amount1);
    console.log(total_amount+total_amount1);
  </script>
  {% endblock  %}


